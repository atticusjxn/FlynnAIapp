default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight"
  lane :beta do
    # Ensure we're using the right scheme and workspace
    gym(
      scheme: "FlynnAI",
      workspace: "FlynnAI.xcworkspace",
      export_method: "app-store",
      clean: true,
      output_directory: "./build",
      buildlog_path: "./build/logs"
    )
    
    # Upload to TestFlight
    pilot(
      username: "admin@mates-rates.app",
      app_identifier: "com.flynnai.app",
      skip_submission: false,
      skip_waiting_for_build_processing: false,
      changelog: "New build uploaded via Fastlane"
    )
  end
  
  desc "Just build the app"
  lane :build do
    gym(
      scheme: "FlynnAI",
      workspace: "FlynnAI.xcworkspace",
      export_method: "app-store",
      clean: true,
      output_directory: "./build",
      buildlog_path: "./build/logs"
    )
  end
end